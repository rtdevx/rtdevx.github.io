{{/* Only render if this post is part of a series */}}
{{ if .Params.series }}

  {{ $series := .Params.series }}

  {{/* Collect all posts in this series */}}
  {{ $seriesPosts := where site.RegularPages "Params.series" $series }}
  {{ $seriesPosts := where $seriesPosts "Params.externalUrl" "==" nil }}

  {{/* Determine if any post has series_order */}}
  {{ $hasOrder := false }}
  {{ range $seriesPosts }}
    {{ if .Params.series_order }}
      {{ $hasOrder = true }}
    {{ end }}
  {{ end }}

  {{/* Sort series posts */}}
  {{ if $hasOrder }}
    {{ $seriesPosts = sort $seriesPosts "Params.series_order" "asc" }}
  {{ else }}
    {{ $seriesPosts = sort $seriesPosts "Date" "asc" }}
  {{ end }}

  {{/* Find index of current post */}}
  {{ $current := . }}
  {{ $index := -1 }}
  {{ range $i, $p := $seriesPosts }}
    {{ if eq $p $current }}
      {{ $index = $i }}
    {{ end }}
  {{ end }}

  {{/* Compute part number (1-based) */}}
  {{ $part := add $index 1 }}

  {{/* Build series index URL */}}
  {{ $seriesSlug := $series | urlize }}
  {{ $seriesURL := printf "/series/%s/" $seriesSlug }}

  <div class="mb-4">
    <div class="text-sm text-neutral-600 dark:text-neutral-400">
      ğŸ“š Part {{ $part }} of {{ len $seriesPosts }}: <i>"{{ $series }}"</i> series.
    </div>

    <div class="text-sm mt-1">
      <a href="{{ $seriesURL }}" class="text-primary-600 dark:text-primary-400 hover:underline">
        â† Back to series overview
      </a>
    </div>
  </div>

{{ end }}